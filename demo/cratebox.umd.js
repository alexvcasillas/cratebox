!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.cratebox={})}(this,function(e){"use strict";function t(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function r(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(r){t(e,r,n[r])})}return e}function n(e){return void 0===e}function o(e){if(null===e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);return t===Object.prototype||null===t}var a=r({},{string:{name:"string",checker:function(e){return"string"==typeof e}},number:{name:"number",checker:function(e){return"number"==typeof e}},boolean:{name:"boolean",checker:function(e){return"boolean"==typeof e}},null:{name:"null",checker:function(e){return null===e}},undefined:{name:"undefined",checker:function(e){return void 0===e}},date:{name:"date",checker:function(e){return e instanceof Date}}},{array:function(e){if(n(e))throw new TypeError("Array type must be declared with a base type as it's argument");if(!function(e){return!n(e)&&e.name&&""!==e.name&&e.checker&&"function"==typeof e.checker}(e))throw new TypeError("The declared type of the array is not a valid base type");return{name:"array",type:e,checker:function(e){var t=this;if(!Array.isArray(e))return!1;if(0===e.length)return!0;var r=!0;return e.forEach(function(e){t.type.checker(e)||(r=!1)}),r}}},enum:function(e){if(n(e)||!Array.isArray(e)||0===e.length)throw new TypeError("Enumeration type must be declared with an array of strings as it's argument with at least one value");return e.forEach(function(e){if("string"!=typeof e)throw new TypeError("Enumeration type must be an array of string literals")}),{name:"enum",enums:e,checker:function(e){return this.enums.includes(e)}}},literal:function(e){if(n(e)||"string"!=typeof e)throw new TypeError("Literal type must be declared with a string literal to check against");return{name:"literal",literal:e,checker:function(t){return t===e}}},optional:function(e,t){if(n(e)||n(t))throw new TypeError("Optional type must be declared with a type plus a default value for that type");return{name:"optional",type:e,defaultValue:t,checker:function(e){return this.type.checker(e)}}},frozen:function(e){if(n(e)||!o(e))throw new TypeError("Frozen type must be declared with and object literal");return{name:"frozen",checker:function(e){return o(e)}}}}),i=function(e){return{model:new Proxy(e,{get:function(e,t,r){return Reflect.get.apply(Reflect,arguments)},set:function(e,t,r,n){throw new Error("You must dispatch an action to change a property of the model")}})}};e.types=a,e.cratebox=function(){var e=new Map,t=new Map,n=new Map;return{describeStore:function(t){if(e.has(t.identifier))throw new Error("You can't describe a new store with the same identifier as a previously described one.");e.set(t.identifier,r({},t.model))},getStoreDescriptions:function(){return e},getStoreDescription:function(t){if(!e.has(t))throw new Error("You're trying to get a store description that doesn't exists.");return e.get(t)},getGlobalState:function(){return t},getState:function(e){if(t.get(e)){var r=t.get(e).currentState;return t.get(e)._data.slice(r,r+1)[0]}return null},dispatch:function(e){var o=e.identifier,a=e.model,c=this.getStoreDescription(o);Object.keys(a).forEach(function(e){if(c.hasOwnProperty(e)){if(!c[e].checker(a[e]))throw new Error('Type "'+typeof a[e]+'" cannot be setted to the property '+e+' described as a/an "'+c[e].name+'"')}else delete a[e]});var u,s,f=t.get(o);if(void 0!==f)s=i(r({},f._data.slice(-1)[0],a)).model,u=f._data.concat([s]);else{var l=i(a).model;u=[l],s=l}var h=u.length-1;t.set(o,{currentState:h,_data:u}),n.has(o)&&n.get(o)(s)},subscribe:function(t,r){if(void 0===t)throw new Error("The subscription method needs a store to subscribe to");if("function"!=typeof r)throw new Error("Subscribe listener is expected to be a function.");if(!e.has(t))throw new Error("You're tyring to subscribe changes for a non-existent store.");if(n.has(t))throw new Error("You're trying to set a listener to a store that already has a listener attached to it.");n.set(t,r)},travelForwards:function(e){var o=t.get(e),a=o.currentState+1;a>=o._data.length||(t.set(e,r({},o,{currentState:a})),n.has(e)&&n.get(e)(this.getState(e)))},travelBackwards:function(e){var o=t.get(e),a=o.currentState-1;a<0||(t.set(e,r({},o,{currentState:a})),n.has(e)&&n.get(e)(this.getState(e)))},travelTo:function(e,t){}}},Object.defineProperty(e,"__esModule",{value:!0})});
