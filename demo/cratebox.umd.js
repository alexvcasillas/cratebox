!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.cratebox={})}(this,function(e){"use strict";var l=function(){return(l=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function r(e){return void 0===e}function t(e){if(null===e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);return t===Object.prototype||null===t}var n=l({},{string:{name:"string",checker:function(e){return"string"==typeof e}},number:{name:"number",checker:function(e){return"number"==typeof e}},boolean:{name:"boolean",checker:function(e){return"boolean"==typeof e}},null:{name:"null",checker:function(e){return null===e}},undefined:{name:"undefined",checker:function(e){return void 0===e}},date:{name:"date",checker:function(e){return e instanceof Date}}},{array:function(e){if(r(e))throw new TypeError("Array type must be declared with a base type as it's argument");if(r(t=e)||!t.name||""===t.name||!t.checker||"function"!=typeof t.checker)throw new TypeError("The declared type of the array is not a valid base type");var t;return{name:"array",type:e,checker:function(e){var t=this;if(!Array.isArray(e))return!1;if(0===e.length)return!0;var r=!0;return e.forEach(function(e){t.type.checker(e)||(r=!1)}),r}}},enum:function(e){if(r(e)||!Array.isArray(e)||0===e.length)throw new TypeError("Enumeration type must be declared with an array of strings as it's argument with at least one value");return e.forEach(function(e){if("string"!=typeof e)throw new TypeError("Enumeration type must be an array of string literals")}),{name:"enum",enums:e,checker:function(e){return this.enums.includes(e)}}},literal:function(t){if(r(t)||"string"!=typeof t)throw new TypeError("Literal type must be declared with a string literal to check against");return{name:"literal",literal:t,checker:function(e){return e===t}}},optional:function(e,t){if(r(e)||r(t))throw new TypeError("Optional type must be declared with a type plus a default value for that type");return{name:"optional",type:e,defaultValue:t,checker:function(e){return this.type.checker(e)}}},frozen:function(e){if(r(e)||!t(e))throw new TypeError("Frozen type must be declared with and object literal");return{name:"frozen",checker:function(e){return t(e)}}}}),d=function(e){return{model:new Proxy(e,{get:function(e,t,r){return Reflect.get(e,t,r)},set:function(e,t,r,n){throw new Error("You must dispatch an action to change a property of the model")}})}};e.types=n,e.cratebox=function(){var r=new Map,f=new Map,h=new Map;return{describeStore:function(e){if(void 0===e)throw new Error("You can't define a store without a store model object");if(!e.hasOwnProperty("identifier"))throw new Error("You can't describe a store without an identifier");if(!e.hasOwnProperty("model"))throw new Error("You can't describe a store without a model");if(r.has(e.identifier))throw new Error("You can't describe a new store with the same identifier as a previously described one.");r.set(e.identifier,l({},e.model))},getStoreDescriptions:function(){return r},getStoreDescription:function(e){if(!r.has(e))throw new Error("You're trying to get a store description that doesn't exists.");return r.get(e)},getGlobalState:function(){return f},getState:function(e){var t=f.get(e)||{};if(!t)return null;if(f.get(e)||void 0!==f.get(e)){var r=t.currentState;return t._data.slice(r,r+1)[0]}return null},dispatch:function(e){if(void 0===e)throw new Error("You can't dispatch changes without a dispatch object: { identifier: string, model: object }");var t=e.identifier,r=e.model;if(!t)throw new Error("You need a store identifier to dispatch changes to");if(!r)throw new Error("You need a model with the changes you would like to apply");var n=this.getStoreDescription(t)||{};Object.keys(r).forEach(function(e){if(n.hasOwnProperty(e)){if(!n[e].checker(r[e]))throw new Error('Type "'+typeof r[e]+'" cannot be setted to the property '+e+' described as a/an "'+n[e].name+'"')}else delete r[e]});var o,i,a,c=f.get(t);void 0!==c?(i=a=d(l({},c._data.slice(-1)[0],r)).model,o=c._data.concat([i])):(o=[a=d(r).model],i=a);var u=o.length-1;if(f.set(t,{currentState:u,_data:o}),h.has(t)){var s=h.get(t)||null;s&&s(i)}},subscribe:function(e,t){if(void 0===e)throw new Error("The subscription method needs a store to subscribe to");if("function"!=typeof t)throw new Error("Subscribe listener is expected to be a function.");if(!r.has(e))throw new Error("You're tyring to subscribe changes for a non-existent store.");if(h.has(e))throw new Error("You're trying to set a listener to a store that already has a listener attached to it.");h.set(e,t)},travelForwards:function(e){var t=f.get(e)||null;if(t){var r=t.currentState+1;if(r>=t._data.length);else if(f.set(e,l({},t,{currentState:r})),h.has(e)){var n=h.get(e)||null;n&&n(this.getState(e))}}},travelBackwards:function(e){var t=f.get(e)||null;if(t){var r=t.currentState-1;if(r<0);else if(f.set(e,l({},t,{currentState:r})),h.has(e)){var n=h.get(e)||null;n&&n(this.getState(e))}}},travelTo:function(e,t){}}},Object.defineProperty(e,"__esModule",{value:!0})});
