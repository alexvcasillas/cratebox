"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var __assign=function(){return(__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},baseTypes={string:{name:"string",checker:function(e){return"string"==typeof e}},number:{name:"number",checker:function(e){return"number"==typeof e}},boolean:{name:"boolean",checker:function(e){return"boolean"==typeof e}},null:{name:"null",checker:function(e){return null===e}},undefined:{name:"undefined",checker:function(e){return void 0===e}},date:{name:"date",checker:function(e){return e instanceof Date}}};function isUndefined(e){return void 0===e}function checkTypeChecker(e){return!isUndefined(e)&&e.name&&""!==e.name&&e.checker&&"function"==typeof e.checker}function isPlainObject(e){if(null===e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);return t===Object.prototype||null===t}var advancedTypes={array:function(e){if(isUndefined(e))throw new TypeError("Array type must be declared with a base type as it's argument");if(!checkTypeChecker(e))throw new TypeError("The declared type of the array is not a valid base type");return{name:"array",type:e,checker:function(e){var t=this;if(!Array.isArray(e))return!1;if(0===e.length)return!0;var r=!0;return e.forEach(function(e){t.type.checker(e)||(r=!1)}),r}}},enum:function(e){if(isUndefined(e)||!Array.isArray(e)||0===e.length)throw new TypeError("Enumeration type must be declared with an array of strings as it's argument with at least one value");return e.forEach(function(e){if("string"!=typeof e)throw new TypeError("Enumeration type must be an array of string literals")}),{name:"enum",enums:e,checker:function(e){return this.enums.includes(e)}}},literal:function(t){if(isUndefined(t)||"string"!=typeof t)throw new TypeError("Literal type must be declared with a string literal to check against");return{name:"literal",literal:t,checker:function(e){return e===t}}},optional:function(e,t){if(isUndefined(e)||isUndefined(t))throw new TypeError("Optional type must be declared with a type plus a default value for that type");return{name:"optional",type:e,defaultValue:t,checker:function(e){return this.type.checker(e)}}},frozen:function(e){if(isUndefined(e)||!isPlainObject(e))throw new TypeError("Frozen type must be declared with and object literal");return{name:"frozen",checker:function(e){return isPlainObject(e)}}}},types=__assign({},baseTypes,advancedTypes),crateModel=function(e){return{model:new Proxy(e,{get:function(e,t,r){return Reflect.get(e,t,r)},set:function(e,t,r,n){throw new Error("You must dispatch an action to change a property of the model")}})}},cratebox=function(){var r=new Map,f=new Map,d=new Map;return{describeStore:function(e){if(void 0===e)throw new Error("You can't define a store without a store model object");if(!e.hasOwnProperty("identifier"))throw new Error("You can't describe a store without an identifier");if(!e.hasOwnProperty("model"))throw new Error("You can't describe a store without a model");if(r.has(e.identifier))throw new Error("You can't describe a new store with the same identifier as a previously described one.");r.set(e.identifier,__assign({},e.model))},getStoreDescriptions:function(){return r},getStoreDescription:function(e){if(!r.has(e))throw new Error("You're trying to get a store description that doesn't exists.");return r.get(e)},getGlobalState:function(){return f},getState:function(e){var t=f.get(e)||{};if(!t)return null;if(f.get(e)||void 0!==f.get(e)){var r=t.currentState;return t._data.slice(r,r+1)[0]}return null},dispatch:function(e){if(void 0===e)throw new Error("You can't dispatch changes without a dispatch object: { identifier: string, model: object }");var t=e.identifier,r=e.model;if(!t)throw new Error("You need a store identifier to dispatch changes to");if(!r)throw new Error("You need a model with the changes you would like to apply");var n=this.getStoreDescription(t)||{};Object.keys(r).forEach(function(e){if(n.hasOwnProperty(e)){if(!n[e].checker(r[e]))throw new Error('Type "'+typeof r[e]+'" cannot be setted to the property '+e+' described as a/an "'+n[e].name+'"')}else delete r[e]});var i,o,a,s=f.get(t);void 0!==s?(o=a=crateModel(__assign({},s._data.slice(-1)[0],r)).model,i=s._data.concat([o])):(i=[a=crateModel(r).model],o=a);var c=i.length-1;if(f.set(t,{currentState:c,_data:i}),d.has(t)){var u=d.get(t)||null;u&&u(o)}},subscribe:function(e,t){if(void 0===e)throw new Error("The subscription method needs a store to subscribe to");if("function"!=typeof t)throw new Error("Subscribe listener is expected to be a function.");if(!r.has(e))throw new Error("You're tyring to subscribe changes for a non-existent store.");if(d.has(e))throw new Error("You're trying to set a listener to a store that already has a listener attached to it.");d.set(e,t)},travelForwards:function(e){var t=f.get(e)||null;if(t){var r=t.currentState+1;if(r>=t._data.length);else if(f.set(e,__assign({},t,{currentState:r})),d.has(e)){var n=d.get(e)||null;n&&n(this.getState(e))}}},travelBackwards:function(e){var t=f.get(e)||null;if(t){var r=t.currentState-1;if(r<0);else if(f.set(e,__assign({},t,{currentState:r})),d.has(e)){var n=d.get(e)||null;n&&n(this.getState(e))}}},travelTo:function(e,t){}}};exports.types=types,exports.cratebox=cratebox;
